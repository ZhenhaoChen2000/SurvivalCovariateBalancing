MDABW = 6
)
color_map <- c(
UNAD  = 'skyblue',
MB    = 'blue',
IPW   = 'black',
EBAL  = 'orange',
CBPS  = 'red',
ENERGY= 'green',
KERNEL= '#D55E00',
MDABW = '#CC79A7'
)
desired_levels <- c('UNAD','ENERGY','IPW','KERNEL','CBPS','MDABW','EBAL','MB')
plot_datcrete2new$weight <- factor(toupper(as.character(plot_datcrete2new$weight)),
levels = desired_levels)
if("UNAD" %in% plot_datcrete2new$weight) {
order_unad <- plot_datcrete2new %>%
filter(weight == "UNAD") %>%
arrange(imbal) %>%
pull(variable) %>%
unique()
plot_datcrete2new$variable <- factor(plot_datcrete2new$variable, levels = order_unad)
} else {
plot_datcrete2new$variable <- factor(plot_datcrete2new$variable, levels = unique(plot_datcrete2new$variable))
}
plot.GASMD_IMP <- ggplot(plot_datcrete2new, aes(x = variable, y = imbal)) +
geom_point(aes(color = weight, shape = weight), size = 3) +
scale_shape_manual(values = shape_map) +
scale_color_manual(values = color_map) +
labs(color = 'Method', shape = 'Method',
title = "Covariate Balance",
subtitle = "Generalized Absolute Standardized Mean Difference",
x = NULL, y = "Generalized Absolute Standardized Mean Difference") +
theme(panel.background = element_rect(fill = "white"),
axis.text.x = element_text(color = "black"),
axis.text.y = element_text(color = "black"),
panel.border = element_rect(fill = NA, color = "black"),
plot.background = element_blank(),
legend.background = element_blank(),
legend.key = element_blank(),
legend.position = "top",
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
geom_hline(yintercept = 0, linetype = "solid", color = "black") +
coord_flip()
png("GASMD_imp.png", width = 6.4, height = 6.4, units = "in", res = 1000)
print(plot.GASMD_IMP)
dev.off()
#save GASMD_imp
write.csv(file = 'gasmd_imp.csv',x=plot_datcrete2[,1:8])
##all variables
###etiology-dummy variable
etiology_dum<-class.ind(hcc$Etiology)
etiology_crete<-data.frame('etiology2'=etiology_dum[,2],'etiology3'=etiology_dum[,3])
####dat is used in the important variable situation
####except BCLC
####hcc colomn=39, 35:39 denote different date (org_date,diag_date,death_date,_last_date)
#dat_all<-data.frame(dat,BMI=hcc$BMI,BMI.cat=hcc$BMI.cat,hypertension=hcc$hypertension,diabetes.type2=hcc$diabetes.type2,
#                    etiology_crete,
#                    Ascites=hcc$Ascites,Cirrhosis=hcc$Cirrhosis,BCLC=hcc$BCLC,GGT=hcc$GGT,ALB=hcc$ALB,Cr=hcc$Cr,PT=hcc$PT,PLT=hcc$PLT,
#                    portal.hypertension=hcc$portal.hypertension,AST=hcc$AST,TBIL=hcc$TBIL,ALP=hcc$ALP,Radiology.HCC.Number=hcc$Radiology.HCC.Number,
#                    Radiology.Largest.Tumor.Diameter=hcc$Radiology.Largest.Tumor.Diameter)
#use BMI.cat instead of BMI
dat_all<-data.frame(dat,BMI.cat=hcc$BMI.cat,hypertension=hcc$hypertension,diabetes.type2=hcc$diabetes.type2,
etiology_crete,
Ascites=hcc$Ascites,Cirrhosis=hcc$Cirrhosis,BCLC=hcc$BCLC,GGT=hcc$GGT,ALB=hcc$ALB,Cr=hcc$Cr,PT=hcc$PT,PLT=hcc$PLT,
portal.hypertension=hcc$portal.hypertension,AST=hcc$AST,TBIL=hcc$TBIL,ALP=hcc$ALP,Radiology.HCC.Number=hcc$Radiology.HCC.Number,
Radiology.Largest.Tumor.Diameter=hcc$Radiology.Largest.Tumor.Diameter)
dat_all_crete<-dat_all[,-(8:12)]
log_allcrete<-dat_all_crete
#log_allcrete[,c(7,16,25:29,31:33)]<-log(dat_all_crete[,c(7,16,25:29,31:33)])
log_allcrete[,c(7,24:28,30:32)]<-log(dat_all_crete[,c(7,24:28,30:32)])
dat_all_crete<-log_allcrete
###the ps score corresponding to individual 109 is 2.439892e+06
dat_all_crete<-dat_all_crete[-109,]
#names(dat_discrete)=c(names(dat_discrete)[1:7],"logAFP",names(dat_discrete)[9:16])
allcrete_con_weight<-weight.esti.nokernel(dat_all_crete[,-c(1:3)],dat_all_crete$trt)
#save allcrete_weight
all_wei_table<-cbind(ps_wei_all=allcrete_con_weight$ps,ebal_wei_all=allcrete_con_weight$ebal,
cbps_wei_all=allcrete_con_weight$cbps,energy_wei_all=allcrete_con_weight$energy,
mb_wei_all=allcrete_con_weight$MB,mdabw_wei_all=allcrete_con_weight$MDABW
)
write.csv(file = 'all_wei_table.csv',x=all_wei_table[,1:6])
png("AKM_all.png",width = 10, height = 6, units = "in", res = 1000)
layout_matrix <- rbind(
c(1,1,1,1),
c(2,3,4,5),
c(6,7,8,9)
)
layout(layout_matrix, heights = c(0.6, 3.5, 3.5))
par(mar = c(0,0,0,0))
plot.new()
legend("center",
legend = c("LT","LR","LA"),
col = c(3,4,5),
lty = 1,
lwd = 2,
horiz = TRUE,
cex = 1.4,
y.intersp = 0.7,
bty = "n")
par(mar = c(6,4,2,1))
akm_rmst(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,
group =as.factor(dat_all_crete$trt))
se_ci_unad_all=get_diff(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,tau = 1606,
group =as.factor(dat_all_crete$trt))
title(main = "UNAD")
akm_rmst(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,
group =as.factor(dat_all_crete$trt),weight = allcrete_con_weight$ps)
se_ci_ps_all=get_diff(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,tau = 1606,
group =as.factor(dat_all_crete$trt),weight = allcrete_con_weight$ps)
title(main = "IPW")
akm_rmst(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,
group =as.factor(dat_all_crete$trt),weight = allcrete_con_weight$cbps)
se_ci_cbps_all=get_diff(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,tau = 1606,
group =as.factor(dat_all_crete$trt),weight = allcrete_con_weight$cbps)
title(main = "CBPS")
akm_rmst(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,
group =as.factor(dat_all_crete$trt),weight = (allcrete_con_weight$ebal+min(allcrete_con_weight$ebal[which(allcrete_con_weight$ebal>10^(-7))])*(allcrete_con_weight$ebal<10^(-7))))
se_ci_ebal_all=get_diff(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,tau = 1606,
group =as.factor(dat_all_crete$trt),weight = (allcrete_con_weight$ebal+min(allcrete_con_weight$ebal[which(allcrete_con_weight$ebal>10^(-7))])*(allcrete_con_weight$ebal<10^(-7))))
title(main = "EBAL")
akm_rmst(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,
group =as.factor(dat_all_crete$trt),weight = allcrete_con_weight$energy)
se_ci_energy_all=get_diff(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,tau = 1606,
group =as.factor(dat_all_crete$trt),weight = allcrete_con_weight$energy)
title(main = "ENERGY")
##### we cannot obtain akm related to kernel method
plot.new()
akm_rmst(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,
group =as.factor(dat_all_crete$trt),weight = (allcrete_con_weight$MDABW+min(allcrete_con_weight$MDABW[which(allcrete_con_weight$MDABW>10^(-7))])*(allcrete_con_weight$MDABW<10^(-7))))
se_ci_MDABW_all=get_diff(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,tau = 1606,
group =as.factor(dat_all_crete$trt),weight = (allcrete_con_weight$MDABW+min(allcrete_con_weight$MDABW[which(allcrete_con_weight$MDABW>10^(-7))])*(allcrete_con_weight$MDABW<10^(-7))))
title(main = "MDABW")
akm_rmst(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,
group =as.factor(dat_all_crete$trt),weight = allcrete_con_weight$MB)
se_ci_mb_all=get_diff(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,tau = 1606,
group =as.factor(dat_all_crete$trt),weight = allcrete_con_weight$MB)
title(main = "MB")
dev.off()
se_ci_all<-rbind(
se_ci_unad_all[1,],
se_ci_ps_all[1,],
se_ci_ebal_all[1,],
se_ci_cbps_all[1,],
se_ci_energy_all[1,],
se_ci_MDABW_all[1,],
se_ci_mb_all[1,],
se_ci_unad_all[2,],
se_ci_ps_all[2,],
se_ci_ebal_all[2,],
se_ci_cbps_all[2,],
se_ci_energy_all[2,],
se_ci_MDABW_all[2,],
se_ci_mb_all[2,],
se_ci_unad_all[3,],
se_ci_ps_all[3,],
se_ci_ebal_all[3,],
se_ci_cbps_all[3,],
se_ci_energy_all[3,],
se_ci_MDABW_all[3,],
se_ci_mb_all[3,]
)
se_ci_all[,-c(1,6)]<-round(se_ci_all[,-c(1,6)],digits = 2)
se_ci_all[,6]<-round(se_ci_all[,6],digits = 3)
se_ci_all
se_ci_all<-cbind(weight=rep(c('Unad','IPW','EBAL','CBPS','Energy','MDABW','MB'),3),se_ci_all,
CI=paste(
paste(
paste('(',se_ci_all$rmst_diff_low),se_ci_all$rmst_diff_upp,sep = ','),')'))
write.csv(file = 'se_ci_all.1606.csv',x=se_ci_all[,c(1,2,3,8,7)])
#trend with tau plot
#get value tau at each time====
ps_tau_allcrete=data.frame(vs12=rep(0,1606),vs13=rep(0,1606),vs23=rep(0,1606))
cbps_tau_allcrete=data.frame(vs12=rep(0,1606),vs13=rep(0,1606),vs23=rep(0,1606))
energy_tau_allcrete=data.frame(vs12=rep(0,1606),vs13=rep(0,1606),vs23=rep(0,1606))
mb_tau_allcrete=data.frame(vs12=rep(0,1606),vs13=rep(0,1606),vs23=rep(0,1606))
ebal_tau_allcrete=data.frame(vs12=rep(0,1606),vs13=rep(0,1606),vs23=rep(0,1606))
no_tau_allcrete=data.frame(vs12=rep(0,1606),vs13=rep(0,1606),vs23=rep(0,1606))
MDABW_tau_allcrete=data.frame(vs12=rep(0,1606),vs13=rep(0,1606),vs23=rep(0,1606))
for (i in 1:1606) {
ps_tau_allcrete[i,]=get_diff(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,
group =as.factor(dat_all_crete$trt),weight = allcrete_con_weight$ps,tau=i)[,2]
cbps_tau_allcrete[i,]=get_diff(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,
group =as.factor(dat_all_crete$trt),weight = allcrete_con_weight$cbps,tau=i)[,2]
energy_tau_allcrete[i,]=get_diff(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,
group =as.factor(dat_all_crete$trt),weight = allcrete_con_weight$energy,tau=i)[,2]
mb_tau_allcrete[i,]=get_diff(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,
group =as.factor(dat_all_crete$trt),weight = allcrete_con_weight$MB,tau=i)[,2]
ebal_tau_allcrete[i,]=get_diff(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,
group =as.factor(dat_all_crete$trt),weight = (allcrete_con_weight$ebal+min(allcrete_con_weight$ebal[which(allcrete_con_weight$ebal>10^(-7))])*(allcrete_con_weight$ebal<10^(-7))),tau=i)[,2]
no_tau_allcrete[i,]=get_diff(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,
group =as.factor(dat_all_crete$trt),tau=i)[,2]
MDABW_tau_allcrete[i,]=get_diff(time=as.numeric(dat_all_crete[,1]),status = dat_all_crete[,2],xaxismax=2000,
group =as.factor(dat_all_crete$trt),tau=i,weight = (allcrete_con_weight$MDABW+min(allcrete_con_weight$MDABW[which(allcrete_con_weight$MDABW>10^(-7))])*(allcrete_con_weight$MDABW<10^(-7))))[,2]
}
ps_tau_allcrete1=cbind(tau=1:1606,ps_tau_allcrete)
cbps_tau_allcrete1=cbind(tau=1:1606,cbps_tau_allcrete)
energy_tau_allcrete1=cbind(tau=1:1606,energy_tau_allcrete)
mb_tau_allcrete1=cbind(tau=1:1606,mb_tau_allcrete)
ebal_tau_allcrete1=cbind(tau=1:1606,ebal_tau_allcrete)
no_tau_allcrete1=cbind(tau=1:1606,no_tau_allcrete)
MDABW_tau_allcrete1=cbind(tau=1:1606,MDABW_tau_allcrete)
p1.all <- ggplot() +
geom_line(data = no_tau_allcrete1, aes(x = tau, y = vs12, colour = "UNAD"), size = 1) +
geom_line(data = mb_tau_allcrete1, aes(x = tau, y = vs12, colour = "MB"), size = 1) +
geom_line(data = ps_tau_allcrete1, aes(x = tau, y = vs12, colour = "IPW"), size = 1) +
geom_line(data = ebal_tau_allcrete1, aes(x = tau, y = vs12, colour = "EBAL"), size = 1) +
geom_line(data = cbps_tau_allcrete1, aes(x = tau, y = vs12, colour = "CBPS"), size = 1) +
geom_line(data = energy_tau_allcrete1, aes(x = tau, y = vs12, colour = "ENERGY"), size = 1) +
geom_line(data = MDABW_tau_allcrete1, aes(x = tau, y = vs12, colour = "MDABW"), size = 1) +
scale_y_continuous(
limits = c(-450, 60),
breaks = seq(-450, 50, by = 50)
) +
scale_x_continuous(
limits = c(0, 1650),
breaks = c(0, 500, 1000, 1500)
) +
ggtitle("LT vs. LR") +
scale_color_manual(
name = "Method",
values = c(
UNAD = "skyblue",
MB = "blue",
IPW = "black",
EBAL = "orange",
CBPS = "red",
ENERGY = "green",
MDABW = "#CC79A7"
),
breaks = c("UNAD", "ENERGY", "IPW", "MDABW", "CBPS", "MB", "EBAL")
) +
theme_bw() +
theme(
panel.grid = element_blank(),
legend.box.background = element_blank(),
legend.background = element_blank(),
plot.title = element_text(hjust = 0.5)
) +
labs(x = "Time (days)", y = "Restricted Mean Survival Time Difference")
p2.all <- ggplot() +
geom_line(data = ps_tau_allcrete1, aes(x = tau, y = vs13, colour = "IPW"), size = 1) +
geom_line(data = cbps_tau_allcrete1, aes(x = tau, y = vs13, colour = "CBPS"), size = 1) +
geom_line(data = energy_tau_allcrete1, aes(x = tau, y = vs13, colour = "ENERGY"), size = 1) +
geom_line(data = mb_tau_allcrete1, aes(x = tau, y = vs13, colour = "MB"), size = 1) +
geom_line(data = ebal_tau_allcrete1, aes(x = tau, y = vs13, colour = "EBAL"), size = 1) +
geom_line(data = no_tau_allcrete1, aes(x = tau, y = vs13, colour = "UNAD"), size = 1) +
geom_line(data = MDABW_tau_allcrete1, aes(x = tau, y = vs13, colour = "MDABW"), size = 1) +
scale_y_continuous(
limits = c(-700, 55),
breaks = seq(-700, 50, by = 50)
) +
scale_x_continuous(
limits = c(0, 1650),
breaks = c(0, 500, 1000, 1500)
) +
ggtitle("LT vs. LA") +
scale_color_manual(
name = "Method",
values = c(
UNAD = "skyblue",
MB = "blue",
IPW = "black",
EBAL = "orange",
CBPS = "red",
ENERGY = "green",
MDABW = "#CC79A7"
),
breaks = c("UNAD", "ENERGY", "IPW", "MDABW", "CBPS", "MB", "EBAL")
) +
theme_bw() +
theme(
panel.grid = element_blank(),
legend.box.background = element_blank(),
legend.background = element_blank(),
plot.title = element_text(hjust = 0.5)
) +
labs(x = "Time (days)", y = "Restricted Mean Survival Time Difference")
p3.all <- ggplot() +
geom_line(data = ps_tau_allcrete1, aes(x = tau, y = vs23, colour = "IPW"), size = 1) +
geom_line(data = cbps_tau_allcrete1, aes(x = tau, y = vs23, colour = "CBPS"), size = 1) +
geom_line(data = energy_tau_allcrete1, aes(x = tau, y = vs23, colour = "ENERGY"), size = 1) +
geom_line(data = mb_tau_allcrete1, aes(x = tau, y = vs23, colour = "MB"), size = 1) +
geom_line(data = ebal_tau_allcrete1, aes(x = tau, y = vs23, colour = "EBAL"), size = 1) +
geom_line(data = no_tau_allcrete1, aes(x = tau, y = vs23, colour = "UNAD"), size = 1) +
geom_line(data = MDABW_tau_allcrete1, aes(x = tau, y = vs23, colour = "MDABW"), size = 1) +
scale_y_continuous(
limits = c(-300, 13),
breaks = seq(-300, 0, by = 50)
) +
scale_x_continuous(
limits = c(0, 1650),
breaks = c(0, 500, 1000, 1500)
) +
ggtitle("LR vs. LA") +
scale_color_manual(
name = "Method",
values = c(
UNAD = "skyblue",
MB = "blue",
IPW = "black",
EBAL = "orange",
CBPS = "red",
ENERGY = "green",
MDABW = "#CC79A7"
),
breaks = c("UNAD", "ENERGY", "IPW", "MDABW", "CBPS", "MB", "EBAL")
) +
theme_bw() +
theme(
panel.grid = element_blank(),
legend.box.background = element_blank(),
legend.background = element_blank(),
plot.title = element_text(hjust = 0.5)
) +
labs(x = "Time (days)", y = "Restricted Mean Survival Time Difference")
png("rmst_all.png", width = 8, height = 5.6, units = "in", res = 1000)
ggarrange(
p1.all, p2.all, p3.all,
nrow = 1, ncol = 3,
common.legend = TRUE,
legend = "top"
)
dev.off()
###love.plot====
chara2<-names(dat_all_crete)
ncolume2<-ncol(dat_all_crete)
allcrete_formula   <- as.formula(paste(chara2[3],
paste(" ~ ", paste(chara2[4:ncolume2],
collapse= "+"))))
# obtain asmd from bal.tab function
plot_allcrete_ASMD_baltab <-  data.frame(
Variable = rownames(bal.tab(allcrete_formula, data = plot_dat2, estimand = "ATE",
stats = c("mean.diffs"), weights = rep(1, nrow(plot_dat2)))$Balance.Across.Pairs),
Unadjusted = as.numeric(bal.tab(allcrete_formula, data = plot_dat2, estimand = "ATE",
stats = "mean.diffs")$Balance.Across.Pairs$Max.Diff.Un),
PS = as.numeric(bal.tab(allcrete_formula, data = plot_dat2, estimand = "ATE",
stats = c("mean.diffs"), weights = allcrete_con_weight$ps)$Balance.Across.Pairs$Max.Diff.Adj),
EBAL = as.numeric(bal.tab(allcrete_formula, data = plot_dat2, estimand = "ATE",
stats = c("mean.diffs"), weights = allcrete_con_weight$ebal)$Balance.Across.Pairs$Max.Diff.Adj),
CBPS = as.numeric(bal.tab(allcrete_formula, data = plot_dat2, estimand = "ATE",
stats = c("mean.diffs"), weights = allcrete_con_weight$cbps)$Balance.Across.Pairs$Max.Diff.Adj),
ENERGY = as.numeric(bal.tab(allcrete_formula, data = plot_dat2, estimand = "ATE",
stats = c("mean.diffs"), weights = allcrete_con_weight$energy)$Balance.Across.Pairs$Max.Diff.Adj),
MDABW = as.numeric(bal.tab(allcrete_formula, data = plot_dat2, estimand = "ATE",
stats = c("mean.diffs"), weights = allcrete_con_weight$MDABW)$Balance.Across.Pairs$Max.Diff.Adj),
MB = as.numeric(bal.tab(allcrete_formula, data = plot_dat2, estimand = "ATE",
stats = c("mean.diffs"), weights = allcrete_con_weight$MB)$Balance.Across.Pairs$Max.Diff.Adj)
)
###love.plot====
chara2<-names(dat_all_crete)
ncolume2<-ncol(dat_all_crete)
allcrete_formula   <- as.formula(paste(chara2[3],
paste(" ~ ", paste(chara2[4:ncolume2],
collapse= "+"))))
# obtain asmd from bal.tab function
plot_dat2<-dat_all_crete
plot_dat2$trt<-factor(plot_dat2$trt)
plot_allcrete_ASMD_baltab <-  data.frame(
Variable = rownames(bal.tab(allcrete_formula, data = plot_dat2, estimand = "ATE",
stats = c("mean.diffs"), weights = rep(1, nrow(plot_dat2)))$Balance.Across.Pairs),
Unadjusted = as.numeric(bal.tab(allcrete_formula, data = plot_dat2, estimand = "ATE",
stats = "mean.diffs")$Balance.Across.Pairs$Max.Diff.Un),
PS = as.numeric(bal.tab(allcrete_formula, data = plot_dat2, estimand = "ATE",
stats = c("mean.diffs"), weights = allcrete_con_weight$ps)$Balance.Across.Pairs$Max.Diff.Adj),
EBAL = as.numeric(bal.tab(allcrete_formula, data = plot_dat2, estimand = "ATE",
stats = c("mean.diffs"), weights = allcrete_con_weight$ebal)$Balance.Across.Pairs$Max.Diff.Adj),
CBPS = as.numeric(bal.tab(allcrete_formula, data = plot_dat2, estimand = "ATE",
stats = c("mean.diffs"), weights = allcrete_con_weight$cbps)$Balance.Across.Pairs$Max.Diff.Adj),
ENERGY = as.numeric(bal.tab(allcrete_formula, data = plot_dat2, estimand = "ATE",
stats = c("mean.diffs"), weights = allcrete_con_weight$energy)$Balance.Across.Pairs$Max.Diff.Adj),
MDABW = as.numeric(bal.tab(allcrete_formula, data = plot_dat2, estimand = "ATE",
stats = c("mean.diffs"), weights = allcrete_con_weight$MDABW)$Balance.Across.Pairs$Max.Diff.Adj),
MB = as.numeric(bal.tab(allcrete_formula, data = plot_dat2, estimand = "ATE",
stats = c("mean.diffs"), weights = allcrete_con_weight$MB)$Balance.Across.Pairs$Max.Diff.Adj)
)
ASMD_allcrete_baltab <- c(plot_allcrete_ASMD_baltab[,2],  # UNAD
plot_allcrete_ASMD_baltab[,6],  # ENERGY
plot_allcrete_ASMD_baltab[,3],  # IPW
plot_allcrete_ASMD_baltab[,7],  # MDABW
plot_allcrete_ASMD_baltab[,5],  # CBPS
plot_allcrete_ASMD_baltab[,8],  # MB
plot_allcrete_ASMD_baltab[,4])  # EBAL
group_allcrete_ASMD_baltab <- rep(c('UNAD','ENERGY','IPW','MDABW','CBPS','MB','EBAL'),
each = nrow(plot_allcrete_ASMD_baltab))
varnames_allcrete_ASMD_baltab <- plot_allcrete_ASMD_baltab$Variable
plot_allcrete_ASMD_baltab2new <- data.frame(
id = rep(1:nrow(plot_allcrete_ASMD_baltab), 7),
variable = rep(varnames_allcrete_ASMD_baltab, 7),
asmd = pmin(1, as.numeric(ASMD_allcrete_baltab)),
ASMD_ord = as.numeric(ASMD_allcrete_baltab),
weight = group_allcrete_ASMD_baltab,
stringsAsFactors = FALSE
)
desired_levels <- c('UNAD','ENERGY','IPW','MDABW','CBPS','MB','EBAL')
color_map <- c(
UNAD  = 'skyblue',
ENERGY= 'green',
IPW   = 'black',
MDABW = '#CC79A7',
CBPS  = 'red',
MB    = 'blue',
EBAL  = 'orange'
)
shape_map <- c(
UNAD  = 15,
ENERGY= 4,
IPW   = 17,
MDABW = 6,
CBPS  = 3,
MB    = 16,
EBAL  = 18
)
plot_allcrete_ASMD_baltab2new$weight <- factor(plot_allcrete_ASMD_baltab2new$weight,
levels = desired_levels)
order_unad <- plot_allcrete_ASMD_baltab2new %>%
filter(weight == "UNAD") %>%
arrange(ASMD_ord) %>%
pull(variable)
plot_allcrete_ASMD_baltab2new$variable <- factor(plot_allcrete_ASMD_baltab2new$variable,
levels = order_unad)
p_baltab_all <- ggplot(plot_allcrete_ASMD_baltab2new, aes(x = variable, y = asmd)) +
geom_point(aes(color = weight, shape = weight), size = 3) +
scale_shape_manual(values = shape_map) +
scale_color_manual(values = color_map) +
labs(color = 'Method', shape = 'Method',
title = "Covariate Balance",
subtitle = "Generalized Absolute Standardized Mean Difference",
x = NULL, y = "Generalized Absolute Standardized Mean Difference") +
theme(panel.background = element_rect(fill = "white"),
axis.text.x = element_text(color = "black"),
axis.text.y = element_text(color = "black"),
panel.border = element_rect(fill = NA, color = "black"),
legend.position = "top",
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
geom_hline(yintercept = 0.1, linetype = "dashed", color = "black") +
geom_hline(yintercept = 0, linetype = "solid", color = "black") +
scale_y_continuous(limits = c(0,1), breaks = c(0, 0.1, 0.25, 0.5, 0.75, 1.0)) +
coord_flip()
png("ASMD_all_cobalt.png", width = 6.4, height = 6.4, units = "in", res = 1000)
print(p_baltab_all)
dev.off()
#save asmd calculated by "bal.tab" function
write.csv(file = 'asmd_cobalt_all.csv',x=plot_allcrete_ASMD_baltab[,1:8])
plot_dat2.1 <- data.frame(allcrete_con_weight$Imbalance)
imbal_2.1 <- c(plot_dat2.1[,1],
plot_dat2.1[,6],
plot_dat2.1[,2],
plot_dat2.1[,3],
plot_dat2.1[,4],
plot_dat2.1[,5],
plot_dat2.1[,7])
group2.1 <- rep(c("UNAD", "MB", "IPW", "EBAL", "CBPS", "ENERGY","MDABW"),
each = nrow(plot_dat2.1))
plot_dat2.1new <- data.frame(
variable = rep(rownames(plot_dat2.1), 7),
id = rep(1:nrow(plot_dat2.1), 7),
imbal = imbal_2.1,
weight = group2.1,
stringsAsFactors = FALSE
)
desired_levels <- c('UNAD','ENERGY','IPW','MDABW','CBPS','MB','EBAL')
color_map <- c(
UNAD  = 'skyblue',
ENERGY= 'green',
IPW   = 'black',
MDABW = '#CC79A7',
CBPS  = 'red',
MB    = 'blue',
EBAL  = 'orange'
)
shape_map <- c(
UNAD  = 15,
ENERGY= 4,
IPW   = 17,
MDABW = 6,
CBPS  = 3,
MB    = 16,
EBAL  = 18
)
plot_dat2.1new$weight <- factor(plot_dat2.1new$weight, levels = desired_levels)
order_unad <- plot_dat2.1 %>%
arrange(unad) %>%
rownames()
plot_dat2.1new$variable <- factor(plot_dat2.1new$variable, levels = order_unad)
plot.GASMD_all <- ggplot(plot_dat2.1new, aes(x = variable, y = imbal)) +
geom_point(aes(color = weight, shape = weight), size = 3) +
scale_shape_manual(values = shape_map) +
scale_color_manual(values = color_map) +
labs(color = 'Method', shape = 'Method',
title = "Covariate Balance",
subtitle = "Generalized Absolute Standardized Mean Difference",
x = NULL, y = "Generalized Absolute Standardized Mean Difference") +
theme(panel.background = element_rect(fill = "white"),
axis.text.x = element_text(color = "black"),
axis.text.y = element_text(color = "black"),
panel.border = element_rect(fill = NA, color = "black"),
plot.background = element_blank(),
legend.background = element_blank(),
legend.key = element_blank(),
legend.position = "top",
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)) +
geom_hline(yintercept = 0, linetype = "solid", color = "black") +
coord_flip()
png("GASMD_all.png", width = 6.4, height = 6.4, units = "in", res = 1000)
print(plot.GASMD_all)
dev.off()
# save gasmd_all
write.csv(file = 'gasmd_all.csv',x=plot_dat2.1[,1:7])
